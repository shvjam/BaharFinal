# مدیریت رانندگان (AdminDrivers)

## توضیحات کلی
این صفحه برای مدیریت کامل رانندگان در سیستم باربری بهار طراحی شده است. ادمین می‌تواند اطلاعات رانندگان، وسایل نقلیه، مدارک و عملکرد آن‌ها را مدیریت کند.

## امکانات اصلی

### 1. لیست رانندگان
- **نمایش جدول کامل**: شامل اطلاعات شخصی، وسیله نقلیه، آمار، امتیاز، درآمد و وضعیت
- **آواتار راننده**: نمایش عکس پروفایل یا اولیه نام
- **نمایش اطلاعات تماس**: شماره موبایل و کد ملی
- **جزئیات وسیله نقلیه**: نوع، پلاک، مدل، رنگ و سال ساخت
- **آمار عملکرد**: تعداد کل سفرها، سفرهای تکمیل شده
- **امتیاز راننده**: نمایش رتبه با آیکون ستاره
- **درآمد کل**: مجموع درآمد راننده (به میلیون تومان)

### 2. فیلترها و جستجو
- **جستجوی زنده**: بر اساس نام، شماره موبایل یا پلاک
- **فیلتر وضعیت**: همه، فعال، غیرفعال، آنلاین، آفلاین
- **فیلتر نوع وسیله**: همه، وانت، نیسان، کامیون، خاور
- **فیلتر تایید مدارک**: همه، تایید شده، تایید نشده

### 3. کارت‌های آماری
- **کل رانندگان**: تعداد کل رانندگان ثبت شده
- **رانندگان فعال**: تعداد رانندگانی که فعال هستند
- **رانندگان آنلاین**: تعداد رانندگانی که در حال حاضر آنلاین هستند
- **مدارک تایید شده**: تعداد رانندگانی که مدارکشان تایید شده
- **میانگین امتیاز**: امتیاز متوسط تمام رانندگان

### 4. افزودن/ویرایش راننده
فرم چند تب شامل:

#### تب اطلاعات شخصی:
- نام و نام خانوادگی (اجباری)
- شماره موبایل (اجباری)
- کد ملی
- تاریخ تولد (با date picker)
- آدرس کامل

#### تب وسیله نقلیه:
- نوع وسیله نقلیه (اجباری): وانت، نیسان، کامیون، خاور
- پلاک (اجباری)
- مدل خودرو
- رنگ
- سال ساخت
- تعداد کارگر همراه (اجباری): تعداد کارگرانی که می‌توانند همراه راننده باشند (0-10)

#### تب مدارک:
- شماره گواهینامه
- تاریخ انقضای گواهینامه
- تصویر گواهینامه (آپلود)
- تصویر کارت خودرو (آپلود)
- تصویر بیمه‌نامه (آپلود)
- عکس پروفایل (آپلود)

#### تب تنظیمات:
- وضعیت فعال/غیرفعال (Switch)
- درصد کمیسیون (0-100%)
- اولویت تخصیص (1-10) - رانندگان با اولویت بالاتر زودتر سفارش می‌گیرند
- یادداشت ادمین (یادداشت‌های داخلی)

### 5. نمایش جزئیات راننده
دیالوگ جامع شامل:

#### اطلاعات کلی:
- عکس پروفایل بزرگ
- نام کامل، شماره موبایل، کد ملی
- بج‌های وضعیت: فعال/غیرفعال، آنلاین/آفلاین، تایید/عدم تایید مدارک

#### کارت‌های آمار عملکرد:
- **کل سفرها**: تعداد کل سفارشات
- **تکمیل شده**: تعداد و درصد سفارشات تکمیل شده
- **امتیاز**: رتبه راننده از 5
- **کل درآمد**: مجموع درآمد (به میلیون تومان)

#### اطلاعات وسیله نقلیه:
- نوع وسیله، پلاک، مدل، رنگ، سال ساخت، تعداد کارگر همراه

#### تاریخچه سفارشات اخیر:
- لیست scroll شونده سفارشات
- شماره سفارش، وضعیت
- نام و شماره مشتری
- مسافت و زمان
- مبلغ نهایی
- تاریخ تکمیل و امتیاز

### 6. عملیات روی رانندگان
منوی dropdown برای هر راننده:
- **مشاهده جزئیات**: نمایش دیالوگ جزئیات کامل
- **ویرایش**: باز کردن فرم ویرایش
- **فعال/غیرفعال کردن**: تغییر وضعیت فعال بودن
- **تایید مدارک**: تایید مدارک راننده (فقط برای مواردی که تایید نشده)
- **حذف**: حذف راننده با تایید

### 7. نشانگرهای بصری
- **بج فعال/غیرفعال**: 
  - فعال: بج آبی
  - غیرفعال: بج خاکستری
- **بج آنلاین**: 
  - بج سبز با نقطه سبز چشمک‌زن
- **بج تایید مدارک**:
  - تایید شده: بج سبز با آیکون تیک
  - در انتظار: بج نارنجی با آیکون علامت تعجب
- **ستاره امتیاز**: ستاره زرد پر شده

## ساختار داده

### Driver Type
```typescript
interface Driver extends User {
  // اطلاعات شخصی
  nationalId?: string;
  dateOfBirth?: Date;
  address?: string;
  
  // وسیله نقلیه
  licensePlate: string;
  vehicleType: VehicleType;
  vehicleModel?: string;
  vehicleColor?: string;
  vehicleYear?: number;
  availableWorkers: number; // تعداد کارگر همراه
  
  // مدارک
  driverLicenseNumber?: string;
  driverLicenseExpiry?: Date;
  driverLicenseImage?: string;
  vehicleCardImage?: string;
  insuranceImage?: string;
  profileImage?: string;
  documentsVerified: boolean;
  verifiedAt?: Date;
  
  // آمار و وضعیت
  rating: number;
  totalRides: number;
  completedRides: number;
  cancelledRides: number;
  totalEarnings: number;
  
  // تنظیمات
  isActive: boolean;
  isOnline: boolean;
  commissionPercentage: number;
  priority: number;
  
  // موقعیت فعلی
  currentLocation?: {
    lat: number;
    lng: number;
  };
  lastLocationUpdate?: Date;
  
  // یادداشت ادمین
  adminNote?: string;
}
```

## نکات مهم

### 1. مدیریت مدارک
- هنگامی که راننده جدید اضافه می‌شود، `documentsVerified` به صورت پیش‌فرض `false` است
- ادمین باید مدارک را بررسی و تایید کند
- پس از تایید، `verifiedAt` با تاریخ فعلی پر می‌شود

### 2. محاسبه درصد تکمیل
- درصد سفارشات تکمیل شده = (completedRides / totalRides) * 100
- در صورتی که totalRides صفر باشد، 0 نمایش داده می‌شود

### 3. نمایش درآمد
- درآمد به تومان است
- برای نمایش، تقسیم بر 1,000,000 شده و به میلیون تبدیل می‌شود
- مثال: 125,000,000 تومان → 125 م

### 4. فیلتر و جستجو
- جستجو case-insensitive است
- می‌توان چندین فیلتر را همزمان اعمال کرد
- نتایج فیلتر شده بلافاصله نمایش داده می‌شوند

### 5. وضعیت آنلاین/آفلاین
- وضعیت آنلاین توسط خود راننده از اپلیکیشن موبایل تغییر می‌کند
- ادمین نمی‌تواند مستقیماً وضعیت آنلاین را تغییر دهد (فقط مشاهده)
- فقط رانندگان آنلاین می‌توانند سفارش جدید بگیرند

### 6. اولویت تخصیص
- عدد بین 1 تا 10
- رانندگان با اولویت بالاتر در الگوریتم تخصیص سفارش زودتر انتخاب می‌شوند
- این قابلیت برای ترجیح دادن رانندگان باتجربه یا پرکار مفید است

## کامپوننت‌های استفاده شده

### از Shadcn UI:
- Button
- Input
- Card
- Table
- Dialog
- DropdownMenu
- Badge
- Avatar
- Select
- Label
- Tabs
- Switch
- Textarea
- Separator
- ScrollArea

### از Lucide React:
- Plus, Search, Filter, MoreVertical
- Edit, Trash2, Eye
- MapPin, Phone, Star
- TrendingUp, Clock
- CheckCircle, XCircle, AlertCircle
- Truck, User, FileText, Settings
- Upload, Users

## Mock Data
فایل شامل داده‌های نمونه برای 3 راننده است:
1. احمد محمدی - وانت - 2 کارگر همراه - فعال و آنلاین - مدارک تایید شده
2. حسین رضایی - نیسان - 3 کارگر همراه - فعال اما آفلاین - مدارک تایید شده
3. علی کریمی - کامیون - 1 کارگر همراه - فعال و آنلاین - مدارک تایید نشده

همچنین شامل یک سفارش نمونه برای نمایش در تاریخچه سفارشات است.

## یادداشت‌های توسعه

### برای اتصال به API:
1. جایگزین کردن `mockDrivers` با فراخوانی API واقعی
2. پیاده‌سازی آپلود فایل برای مدارک
3. اضافه کردن pagination برای لیست رانندگان
4. پیاده‌سازی نمایش موقعیت فعلی راننده روی نقشه
5. اضافه کردن گزارش‌های تحلیلی و نمودار عملکرد

### بهبودهای آینده:
- اضافه کردن نقشه برای نمایش موقعیت فعلی راننده
- امکان ارسال پیام به راننده
- نمودار عملکرد هفتگی/ماهانه راننده
- تاریخچه تغییرات وضعیت و مدارک
- سیستم اعلان برای مدارک منقضی شده (گواهینامه، بیمه)
- گزارش تخلفات و شکایات
- امکان تعلیق موقت راننده

## مسیر دسترسی
```
/admin/drivers
```

## نقش کاربری مجاز
- فقط ADMIN

## وابستگی‌ها
- AuthContext: برای بررسی دسترسی
- Toast (Sonner): برای نمایش پیام‌های موفقیت/خطا
- React Router: برای مسیریابی
